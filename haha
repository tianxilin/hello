package book;
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.sql.*;
public class Login extends JFrame
{
private static final long serialVersionUID = 1L;
private  JLabel JLb1;
private  JLabel JLb2;
private  JButton Ok_btn;
private  JButton Cancel_btn;
private  JTextField Jtfld1;
private  JPasswordField Jtfld2;
private JFrame frame;
private Connection con;
private Statement stmt;
public Login()
{
JFrame.setDefaultLookAndFeelDecorated(true);
frame=new JFrame("登陆");
frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
Container content=frame.getContentPane();
content.setLayout(new GridLayout(3,2,20,20));
JLb1=new JLabel("用户名:");
JLb2=new JLabel("密码:");
Jtfld1=new JTextField();
Jtfld2=new JPasswordField();
Ok_btn=new JButton("确定");
Cancel_btn=new JButton("取消");
Ok_btn.addActionListener(new ActionHandler());
Cancel_btn.addActionListener(new ActionHandler());
content.add(JLb1);
content.add(Jtfld1);
content.add(JLb2);
content.add(Jtfld2);
content.add(Ok_btn);
content.add(Cancel_btn);
frame.pack();
frame.setLocationRelativeTo(null);
frame.setSize(300,200);
frame.setVisible(true);

try{
Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
con=DriverManager.getConnection("jdbc:odbc:library");
stmt=con.createStatement();
}
catch(ClassNotFoundException e)
{
}
catch(SQLException ex)
{
}
}
class ActionHandler implements ActionListener
{
@SuppressWarnings("deprecation")
public void actionPerformed(ActionEvent e)
{
String str1,str2,username,sqlStr;
Object obj=e.getSource();
str1=Jtfld1.getText().trim();
str2=Jtfld2.getText().trim();
try{
if(obj.equals(Ok_btn))
{
if(str1.equals(""))
{
JOptionPane.showMessageDialog(frame,"用户名不能为空");
return;
}
sqlStr="select * from login where user_name="+"'"+str1+"'"+
" and psw="+"'"+str2+"'";
ResultSet result=stmt.executeQuery(sqlStr);
if(result.next())
{
username=result.getString("user_name");
if(str1.equals("管理员"))
{
JOptionPane.showMessageDialog(frame,"欢迎光临！");
new MainFrame();
}
else
{
JOptionPane.showMessageDialog(frame,"欢迎光临！");
MainFrame mainFrame=new MainFrame();
mainFrame.menuItem3.setEnabled(false);
mainFrame.menuItem6.setEnabled(false);
mainFrame.menuItem7.setEnabled(false);
mainFrame.menuItem8.setEnabled(false);
mainFrame.menuItem9.setEnabled(false);
}
frame.dispose();
stmt.close();
con.close();
}
else
{
JOptionPane.showMessageDialog(frame,"输入名或密码错误！");
}
}
else
{
frame.dispose();
stmt.close();
con.close();
}
}
catch(SQLException ex)
{
System.err.println(ex);
}
}
}
public static void main(String[]args)
{
javax.swing.SwingUtilities.invokeLater(new Runnable()
{
public void run()
{
new Login();
}
});
}
}
